<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>Echoria Awards 2025</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      color: #fff;
      background: url('/images/background.gif') center/cover no-repeat fixed;
      background-color: #0a0a0a;
      position: relative;
      min-height: 100vh;
    }
    .overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.65);
      z-index: 0;
    }
    .content { position: relative; z-index: 1; padding-bottom: 80px; }

    /* –®–∞–ø–∫–∞ */
    .top-bar { display: flex; justify-content: space-between; align-items: center; padding: 20px 40px; }
    .btn-discord { background-color: #5865f2; color: #fff; border: none; padding: 10px 25px; border-radius: 30px; font-weight: 600; text-decoration: none; }
    
    /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Ñ–ª–∞–≥–∏ */
    .title-paraflags { display: flex; align-items: flex-start; justify-content: center; gap: 60px; margin: 0 auto; padding-top: 60px; }
    .paraflag { position: relative; transform-origin: top center; animation: paraWave 5s ease-in-out infinite; animation-delay: var(--delay, 0s); }
    .paraflag-pole { width: 6px; height: 200px; background: linear-gradient(to bottom, #666, #222); margin: 0 auto; border-radius: 3px; }
    .paraflag-cloth { width: 140px; height: 220px; background: linear-gradient(135deg, #080808 50%, #111 50%); border: 1px solid rgba(255, 255, 255, 0.1); clip-path: polygon(0 0, 100% 0, 88% 100%, 0 100%); display: flex; align-items: center; justify-content: center; }
    .paraflag-img { height: 110px; object-fit: contain; }
    @keyframes paraWave { 0%, 100% { transform: rotate(2deg); } 50% { transform: rotate(-2deg); } }
    .title-paraflags h1 { font-size: 3.5rem; font-weight: 900; text-transform: uppercase; align-self: center; text-align: center; }

    /* –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –±–ª–æ–∫ */
    .center-plate { margin: 40px auto; padding: 30px 40px; max-width: 550px; background: rgba(255, 255, 255, 0.07); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.15); border-radius: 20px; text-align: center; }
    
    /* –ò–Ω—Ñ–æ-–±–ª–æ–∫–∏ */
    .info-container { max-width: 800px; margin: 0 auto; padding: 0 20px; }
    .info-block { margin-bottom: 25px; padding: 35px; background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 20px; }

    /* –ú–æ–¥–∞–ª–∫–∏ */
    .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 1000; display: none; align-items: center; justify-content: center; }
    .modal-box { width: 90%; max-width: 450px; background: #111; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 20px; padding: 40px; text-align: center; }
    
    /* –°—Ç–∏–ª–∏ –ø–æ–ª–µ–π –≤–≤–æ–¥–∞ - –¢–µ–∫—Å—Ç –ø–æ —Ü–µ–Ω—Ç—Ä—É */
    .form-control-custom {
        background-color: #1a1a1a !important;
        color: white !important;
        border: 1px solid #333 !important;
        text-align: center !important;
        border-radius: 10px;
        padding: 12px;
    }
    .form-control-custom::placeholder { color: #666; }
  </style>
</head>
<body>
  <div class="overlay"></div>
  <div class="content">
    
    <div class="top-bar">
      <div></div>
      <% if (!user) { %>
        <a href="/login" class="btn-discord">–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Discord</a>
      <% } else { %>
        <div class="d-flex align-items-center gap-3">
          <span style="color: white;">–ü—Ä–∏–≤–µ—Ç, <strong><%= user.global_name || user.username %></strong></span>
          <a href="/logout" class="btn btn-sm btn-outline-light">–í—ã–π—Ç–∏</a>
        </div>
      <% } %>
    </div>

    <div class="title-paraflags" data-aos="zoom-in">
      <div class="paraflag" style="--delay:-1.2s;"><div class="paraflag-pole"></div><div class="paraflag-cloth"><img src="/images/katana.png" class="paraflag-img"></div></div>
      <h1>Echoria<br>Awards 2025</h1>
      <div class="paraflag" style="--delay:1.2s;"><div class="paraflag-pole"></div><div class="paraflag-cloth"><img src="/images/katana.png" class="paraflag-img"></div></div>
    </div>

    <div class="center-plate" data-aos="fade-up">
      <div style="font-size: 2.5rem;">üèÜ</div>
      <div style="font-size: 1.4rem; font-weight: 700;">–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–æ</div>
      <p style="opacity: 0.7;">–ü–æ–¥–¥–µ—Ä–∂–∏ –ª—É—á—à–µ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞</p>
      <% if (user) { %>
        <button id="openModal" class="btn btn-light mt-3 px-5 fw-bold">–í—ã–±—Ä–∞—Ç—å –Ω–æ–º–∏–Ω–∞—Ü–∏—é</button>
      <% } else { %>
        <p class="text-warning mb-2">–ß—Ç–æ–±—ã –≥–æ–ª–æ—Å–æ–≤–∞—Ç—å, –Ω—É–∂–Ω–æ –≤–æ–π—Ç–∏</p>
        <a href="/login" class="btn btn-discord px-4">–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Discord</a>
      <% } %>
    </div>

    <div class="info-container">
        <div class="info-block" data-aos="fade-up">
            <h3>–ß—Ç–æ —Ç–∞–∫–æ–µ Echoria Awards?</h3>
            <p style="opacity: 0.8;">–ï–∂–µ–≥–æ–¥–Ω–∞—è –ø—Ä–µ–º–∏—è —Å–µ—Ä–≤–µ—Ä–∞ Echoria. –¢–≤–æ–π –≥–æ–ª–æ—Å —Ä–µ—à–∞–µ—Ç, –∫—Ç–æ —Å—Ç–∞–Ω–µ—Ç –ª—É—á—à–∏–º –≤ —ç—Ç–æ–º –≥–æ–¥—É.</p>
        </div>
        <div class="info-block" data-aos="fade-up" data-aos-delay="100">
            <h3>–ö–∞–∫ –ø—Ä–∏–Ω—è—Ç—å —É—á–∞—Å—Ç–∏–µ?</h3>
            <p style="opacity: 0.8;">1. –ê–≤—Ç–æ—Ä–∏–∑—É–π—Å—è —á–µ—Ä–µ–∑ Discord.<br>2. –í—ã–±–µ—Ä–∏ –Ω–æ–º–∏–Ω–∞—Ü–∏—é –≤ –º–µ–Ω—é –≤—ã—à–µ.<br>3. –í–ø–∏—à–∏ –Ω–∏–∫–Ω–µ–π–º —Å–≤–æ–µ–≥–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞.</p>
        </div>
    </div>
  </div>

  <div class="modal-overlay" id="modalOverlay">
    <div class="modal-box">
      <h4 class="mb-4">–í—ã–±–µ—Ä–∏—Ç–µ –Ω–æ–º–∏–Ω–∞—Ü–∏—é</h4>
      <div class="d-grid gap-2">
        <button class="btn btn-outline-light" data-nom="–°—Ç—Ä–∏–º–µ—Ä –≥–æ–¥–∞">–°—Ç—Ä–∏–º–µ—Ä –≥–æ–¥–∞</button>
        <button class="btn btn-outline-light" data-nom="–ú–µ–º –≥–æ–¥–∞">–ú–µ–º –≥–æ–¥–∞</button>
        <button class="btn btn-outline-light" data-nom="–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä –≥–æ–¥–∞">–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä –≥–æ–¥–∞</button>
      </div>
      <button id="cancelBtn" class="btn btn-link text-secondary mt-3 text-decoration-none">–û—Ç–º–µ–Ω–∞</button>
    </div>
  </div>

  <div class="modal-overlay" id="modalStep2">
    <div class="modal-box">
      <h4 class="mb-4">–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ</h4>
      <input type="text" id="vName" class="form-control form-control-custom mb-3" placeholder="–ò–º—è">
      <input type="text" id="vDiscord" class="form-control form-control-custom mb-3" placeholder="ID –∞–∫–∫–∞—É–Ω—Ç–∞">
      <div class="d-flex gap-2">
        <button id="backBtn" class="btn btn-outline-secondary w-50">–ù–∞–∑–∞–¥</button>
        <button id="submitBtn" class="btn btn-primary w-50">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script>
    AOS.init();
    const overlay = document.getElementById('modalOverlay');
    const step2 = document.getElementById('modalStep2');
    const openBtn = document.getElementById('openModal');
    let currentNomination = '';

    openBtn.onclick = () => overlay.style.display = 'flex';
    document.getElementById('cancelBtn').onclick = () => overlay.style.display = 'none';
    document.getElementById('backBtn').onclick = () => { step2.style.display = 'none'; overlay.style.display = 'flex'; };

    document.querySelectorAll('[data-nom]').forEach(btn => {
      btn.onclick = () => {
        currentNomination = btn.dataset.nom;
        overlay.style.display = 'none';
        step2.style.display = 'flex';
      };
    });

    document.getElementById('submitBtn').onclick = function() {
      const name = document.getElementById('vName').value.trim();
      const discord = document.getElementById('vDiscord').value.trim();
      
      if(!name || !discord) {
        alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è!');
        return;
      }

      const params = new URLSearchParams();
      params.append('nomination', currentNomination);
      params.append('choice', name + ' (' + discord + ')');

      fetch('/vote', {
        method: 'POST',
        body: params
      }).then(response => {
          if (response.ok) {
            window.location.href = '/thanks';
          } else if (response.status === 401) {
            alert('–û—à–∏–±–∫–∞: –í—ã –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã!');
            window.location.href = '/login';
          } else if (response.status === 409) {
            alert('–í—ã —É–∂–µ –≥–æ–ª–æ—Å–æ–≤–∞–ª–∏ –≤ —ç—Ç–æ–π –Ω–æ–º–∏–Ω–∞—Ü–∏–∏!');
            window.location.href = '/thanks';
          }
      }).catch(err => {
          console.error(err);
          alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è');
      });
    };
  </script>
</body>
</html>